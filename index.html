<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Soccer player analysis</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <link rel="stylesheet" href="stylesheets/d3_styles.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="apple-touch-icon" sizes="57x57" href="favicons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="favicons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="favicons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="favicons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="favicons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="favicons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="favicons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="favicons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="favicons/favicon-194x194.png" sizes="194x194">
    <link rel="icon" type="image/png" href="favicons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="favicons/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="favicons/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="favicons/manifest.json">
    <link rel="mask-icon" href="favicons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#b38e8e">

    <!Reference to image slider>
    <link href="javascripts/slider/js-image-slider.css" rel="stylesheet" type="text/css" />
    <script src="javascripts/slider/js-image-slider.js" type="text/javascript"></script>
    
    <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
    <!Code for the D3 visualization>
    <script type="text/javascript"></script>
    <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
    <script src="javascripts/d3_js.js"></script>
    <style type="text/css">
            circle:hover {
                fill: orange;
            }
            .btn {
                background: #3498db;
                background-image: -webkit-linear-gradient(top, #3498db, #2980b9);
                background-image: -moz-linear-gradient(top, #3498db, #2980b9);
                background-image: -ms-linear-gradient(top, #3498db, #2980b9);
                background-image: -o-linear-gradient(top, #3498db, #2980b9);
                background-image: linear-gradient(to bottom, #3498db, #2980b9);
                -webkit-border-radius: 4;
                -moz-border-radius: 4;
                border-radius: 4px;
                font-family: Arial;
                color: #ffffff;
                font-size: 13px;
                padding: 4px 4px 4px 4px;
                text-decoration: none;
            }
            .btn:hover {
                background: #3cb0fd;
                background-image: -webkit-linear-gradient(top, #3cb0fd, #3498db);
                background-image: -moz-linear-gradient(top, #3cb0fd, #3498db);
                background-image: -ms-linear-gradient(top, #3cb0fd, #3498db);
                background-image: -o-linear-gradient(top, #3cb0fd, #3498db);
                background-image: linear-gradient(to bottom, #3cb0fd, #3498db);
                text-decoration: none;
            }
            .header-cont {
                width:100%;
                position:fixed;
                top:0px;
                height:130px;
                background-image:url('logos/pattern_bg.jpeg')
            }
            .wrapper{
                margin-top:90px;
            }
            .content {
                margin-left: auto;
                margin-right: auto;
                table-layout: fixed;
                border-collapse: collapse;
                z-index: -1; position:relative
            }
    </style>
  </head>
  <body>
    <div class="header-cont">
      <img src = "logos/Arsenal_FC.png" width = 10% height = 100 style="border-style: none">
      <img src = "logos/PSG.png" width = 10% height = 100 style="border-style: none">
      <img src = "logos/BayernMunich.png" width = 10% height = 100 style="border-style: none">
      <img src = "logos/Real_Madrid.png" width = 10% height = 100 style="border-style: none">
      <img src = "logos/FC_Barcelona.png" width = 10% height = 100 style="border-style: none">
      <img src = "logos/Juventus.png" width = 8% height = 100 style="border-style: none">
      <img src = "logos/BorussiaDortmund.png" width = 10% height = 100 style="border-style: none">
      <img src = "logos/Inter_Milan.png" width = 10% height = 100 style="border-style: none">
      <img src = "logos/Chelsea_FC.png" width = 10% height = 100 style="border-style: none">
    </div>
  
    <div class="wrapper">
      <header>
        <h1 class="header">cs109-FIFA</h1>
        <p class="header">Future Impact Football Analytics</p>

        <ul>
          <li><a class="sbuttons" href="https://github.com/cs109-FIFA/cs109-FIFA/blob/master/Process%20Workbook.ipynb">Process Notebook</a></li>
          <li><a class="sbuttons" href="https://github.com/cs109-FIFA/cs109-FIFA/Data">Data Repository</a></li>
          <li><a class="buttons github" href="https://github.com/twkillian/cs109-FIFA">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/twkillian">Taylor Killian</a>, <a class="header name" href="https://github.com/abhishekmalali">Abhishek Malali</a> and <a class="header name" href="https://github.com/virgodi">Virgile Audi</a></p>


      </header> 
        
      <section>
        <h1><a id="cs109-FIFA" class="anchor" href="#cs109-fifa" aria-hidden="true"><span class="octicon octicon-link"></span></a>Evaluation of football player performance</h1>
         
          <p>The primary motive of the project outlined below was designed to answer the following question: Can we evaulate and infer a player's value to his team based solely on the impact that they have on matches? In this respect, and to simplify our analysis, we define "impact" to mean the goals and assists provided for their team during various game states.</p>

      </section>
      <section>
        <h1><a id="cs109-FIFA" class="anchor" href="#cs109-fifa" aria-hidden="true"><span class="octicon octicon-link"></span></a>Project Overview</h1>

        <iframe width="560" height="315" src="https://www.youtube.com/embed/m2rhRJkWOEI" frameborder="0" allowfullscreen></iframe>

        <h3>Background and Motivation</h3>


        <p>When football clubs do not perform equal to their, and their fans', expectations they look to infuse their team with more talented players, typically drawn from lower-tier or financially poor teams. The financial incentive for both teams in any transaction is clear, the buying team has hope that the new addition will put them over the top talent-wise to improve their standing in league competition while the selling team may look at the new funds as a way to prepare for the future and secure several new players to improve their team long-term.</p>
        
        <p>Within the last 5 years, the economy of player transfers has undergone significant inflation where the top-tier clubs have shown a willingness to overpay for marginal talent or for players that may not be a good fit in their team. There is some notion that the transfer system is broken and is in need of revitalization. There are multiple ways to address the psychology of club executives and try to identify their motivations for spending money to procure new talent for their team. We refrain from any investigation into club finances but want to determine a method by which we can accurately and objectively place value on any player based on the impact that they have on the matches they play in.</p>
        
        <h3>Project Objectives</h3>
        <p>Our primary motivation is to quantify the impact (based on goals scored, assists made and consistency of play) an individual player has on the games which he plays for his team. We intend to use this quantity for each player to infer their value (agnostic of team at first). With this calculated player impact value, we attempt to group and classify separate tiers of player impact with the goal of identifying what players have performed to the value placed on them in reality.</p>

      <!Section 1 - How transfer market has behaved>
      <!Insert all images inside div with class content>
      <section>
        <h1>
        <a id="cs109-FIFA" class="anchor" href="#cs109-fifa" aria-hidden="true"><span class="octicon octicon-link"></span></a>Player transfer market over the years</h1>

        <table style="width:125%" border="0" >
          <col width="550">
          <col width="650">
          <tr>
            <td><p align='left'>The player transfer market has seen ever increasing transfer amounts over the years. Ever increasing broadcasting deals have made the leagues richer which has reflected in the spending.</p>

              <p align='left'>We looked at the top 100 transfers in the last 20 years. The last five years alone account for 65 transfers in the top 100 list with the transfer record being shattered twice. This trend motivated us to investigate if the market was inflated and whether or not the players justified their value for the respective transfer amount.</p>
            </td>
            <td>
              <div class="content">
              <div id="sliderFrame" >
                <div id="slider">
                    <img src='images/amount.png'  align='middle' style="border-style: none">
                    <img src='images/number.png'  align='middle' style="border-style: none">
                </div>
              </div>
              </div>

            </td> 
          </tr>       
        </table>


      </section>
      <section>
        <h1><a id="cs109-FIFA" class="anchor" href="#cs109-fifa" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data Acquisition</h1>
        <p> The data we use for our analysis is scraped is from <a href="http://www.worldfootball.net">World Football.net</a>. World Football has match by match data in terms of the players who participated in the games as well as the goal scorers. The site had data for all the five leagues which we were interested in. The url links were not hard to deal with provided we had a list of teams which participated in a league for that year. An example url that we visited to acquire data can be viewed <a href="http://www.worldfootball.net/report/premier-league-2012-2013-swansea-city-everton-fc/">here</a>. We scraped the goalscorers, players who assisted the goalscorer along with the time at which the goal was scored. We also recorded whether the goal scorer or assist maker were substituted. We scraped the data from the top 5 European leagues (British, Spanish, German, Italian and French) for the complete 2012-13 and 2013-14 seasons. Overall we scraped 760 pages for each league which totaled ~3800 webpages.</p>

        <p>The transfer values were scraped from the <a href='https://en.wikipedia.org/wiki/Football'>Wikipedia</a> page for transfers for each league for each season we considered. The French and the German league did not have transfer values mentioned for the seasons under consideration. The Spanish league did not have transfer data available for the summer of 2014. An example of the data which we had to scrape can be viewed <a href="https://en.wikipedia.org/wiki/List_of_English_football_transfers_summer_2013">here</a>.</p>
    </section>
      <!Inserting the D3 Visualization>
      <section>
          <h1><a id="transfer-plot" class="anchor" href="#cs109-fifa" aria-hidden="true"><span class="octicon octicon-link"></span></a>Plot comparing transfers across leagues</h1>
        <p>We wanted to visualize where the big money transfers were happening. The plot below was built in D3 for specifically that purpose. It was see the emphasis of the price of the player on different emtrics like goals, assists and the metric score generated by us. This could also help find groupings of players who were available in the similar price range while providing the same attacking punch in terms of goals.</p>
        <div id="wrapper">
        <div id="england">
        <input name="engButton" 
           type="button"
           class='btn'
           value="English League" 
           onclick="viewEngland()" />
        </div>
        <div id="spain">
        <input name="engButton" 
           type="button"
           class='btn'
           value="Spanish League" 
           onclick="viewSpain()" />
        </div>
        <div id="italy">
        <input name="engButton" 
           type="button"
           class='btn'
           value="Italian League" 
           onclick="viewItaly()" />
        </div>
        <div id="sval">
        <input name="engButton" 
           type="button"
           class='btn'
           value="By Season Value" 
           onclick="viewSeasonValue()" />
        </div>
        <div id="goals">
        <input name="engButton" 
           type="button" 
           class='btn'
           value="By Goals" 
           onclick="viewGoals()" />
        </div>
        <div id="assists">
        <input name="engButton" 
           type="button"
           class='btn'
           value="By Assists" 
           onclick="viewAssists()" />
        </div>
    </div>
    <div id="chartline1" ></div> 
      </section>
    
    <section>
        <h1><a id="cs109-FIFA" class="anchor" href="#cs109-fifa" aria-hidden="true"><span class="octicon octicon-link"></span></a>Metric used for player Valuation</h1>

        <p>Relevant details about the metric.</p>
    </section>

      <section>
        <h1><a id="cs109-FIFA" class="anchor" href="#cs109-fifa" aria-hidden="true"><span class="octicon octicon-link"></span></a>Clustering the players on the basis of metrics</h1>
        <p>As football enthusiasts a key question we wanted to address was to find the players which are valued similarly, as per our metric. This would be meaningless if it was done only using goals and assists since those numbers can distract from a player's true impact on his team. Hence we used the entirety of the data including the unwrapped contribution time series. This would cluster players who contribute similarly in the games as well over the seasons.</p>

        <p>We found clusters of similarly influential players for both seasons. An interesting way of looking at long-term performance would be finding players who move between clusters over seasons. This can indicate a player's improvement or decline in performance from season to season. With enough data and multiple seasons, we would then be able to track a players trajectory and possibly predict their future performance.</p>
        <iframe width="600" height="500" frameborder="0" scrolling="no" src="https://plot.ly/~AbhishekMalali/20.embed" class="iframe-class"></iframe>
        <iframe width="600" height="500" frameborder="0" scrolling="no" src="https://plot.ly/~AbhishekMalali/24.embed" class="iframe-class"></iframe>

        <p> An interesting note to make here would be that Messi is classified with Robin van Persie who had fewer goals and assists. He was, however, equally influential in helping his team to the British Premier League title. These were the kind of clusters and observations we were hoping we would see when we processed and analyzed our data.</p>
         
    </section>
    <section>
        <h1><a id="cs109-FIFA" class="anchor" href="#cs109-fifa" aria-hidden="true"><span class="octicon octicon-link"></span></a>Validating our metric</h1>

        <h3><a id="cs109-FIFA" class="anchor" href="#cs109-fifa" aria-hidden="true"><span class="octicon octicon-link"></span></a>Top players over the period</h3>

        <p>Using traditional statistics, we look at the best players in terms of goals and assists. The first plot show the best players for the season of 2012-13. The top players were names you would have heard of even if you aren't as ardent a soccer fan as our team.</p>
        <div class="content">
        <img src='images/2012-13-top20-traditional.jpg' height=330 align='middle' style="border-style: none">
        </div>
        <p>We evaluate the top players for the season of 2012-13 using the metric which we have defined. Our list of top 20 players is very similar to the list we generated using traditional statistics. But in effect there are a few names we might come across as anomalies like Stephan Kiessling. This shows the intent of our metric, where credit is given to players who are contribute to their teams success but are easily overlooked when only looking at their absolute statistics. This demonstrates the utility of valuing players based on the impact they have on the outcome of a match.</p>
        <div class="content">
        <img src='images/2012-13-top20-metric.jpg' height=330 align='middle' style="border-style: none">
        </div>
        <p></p>
        
        <div class="content">
        <img src='images/rankingDiff2.jpg' height=400 align='right' style="border-style: none">
        </div> 
        <p>We chart the ranking according to our metric compared to the ranking with traditional statistics. The 45 degree line is plotted for reference. We see that certain players who were ranked highly as per the goals + assist metric did fall down the ranking ladder when the metric changed. The metric does not affect the top players since we see a close grouping near the origin. But as we go down the ranking ladder we see significant jumps. We find lots of players who weren't ranked well now within the top 50. This directly states that we are doing a decent job of finding underrated players who contribute immensely but are not noticed.</p>


        <h3>What about the giants?</h3>
        <p>For the two most globally recognisable players, Lionel Messi and Cristiano Ronaldo we see how their scores evolve over the season in the plot below. Consistent performance over the course of the season is the most desirable trend among succesful forwards.</p>
        <div class="content">
        <img src='images/messi-vs-ronaldo-12-13.jpg' height=350 align='middle' style="border-style: none">
        </div>
        <p>As is shown in the time series above, Messi consistently outperformed Ronaldo in almost every game for the 2012-13 season. The contribution was recognized and rewarded as Messi was named the FIFA World Player of the Year following the 2012 season.</p>

        <p>We were keen on analyzing these time series for some interesting players for a season. But complexity of analyzing every set of players visually and making key discoveries was cumbersome.</p>

    <h3>Predictive Power of our metric</h3>

    <h5>League Prediction</h5>
        
      <p>To check consistency of our metric against what actually happened in the seasons we evaluated, we combine the scores for each player in a team. We then rank each team in the league by their aggregate score and compare this ranking to the actual place the team finished the season. As the figure shows below, the rankings predicted by our measure were not far from the actual results and showed correlations no worse than 0.73.</p>

      <div class="content">
        <table>
        <tr>
          <td>
              <img src='images/correlation-plot-bpl-12-13.png' height=250 style="border-style: none">
          </td>
          <td>
              <img src='images/correlation-plot-spl-12-13.png' height=250>
          </td>
          <td rowspan="2">
              <img src='images/correlation-plot-bund-12-13.png' height=250 style="border-style: none">
          </td>
        </tr>
        <tr>
          <td>
              <img src='images/correlation-plot-fr-12-13.png' height=250>
          </td>
          <td>
              <img src='images/correlation-plot-ita-12-13.png' height=250 style="border-style: none">
          </td>
        </tr>
      </table>
    </div>
    
      <p>The leagues that our metric most accurately predicted, when aggregated by team, were the Spanish (corr = 0.92) and French (corr = 0.88) leagues. Traditionally these leagues are known for allowing for more goals and since our metric, at present, is solely based on scoring statistics it is clear these successes are understandable. The British, German and Italian leagues are more measured defensively and it is inferred that the less accurate prediction of these leagues is due to not accounting for defensive statistics. </p>

    <h5>Individual Player Prediction</h5>
        
      <p>In order to further validate our metric of player impact we trained two separate regressions, trained on the data from the 2012-13 season and tested on the 2013-14 season.Initially, we trained a random forest regressor and then utilized an ordinary linear regression.</p>

      
        
      <div class="content">
        <img src='images/feature-importance-corrected.jpg' height=450 align='middle' style="border-style: none">
      </div>
      
      <p>Once we trained our regressions we wanted to get a sense of the influence each feature, derived from our metric, had on our prediction model. We see that the importance of the 'ngoals' and 'nassists' (the number of goals and assists respectively) far outweigh the others as would be expected. It is satisfying to see that the other features describing different aspects of the goal are also nontrivial and contribute to the final prediction model. With the assurance that our model was utilizing the extracted features from our data correctly we move on to actually predicting the performance of players, based on our metric, in the following season.</p>
      
      <div class="content">
        <table>
          <tr>
            <th>
              <p align="center">Random Forest</p>
            </th>
            <th>
              <p align="center">Linear Regression</p>
            </th>
          </tr>
          <tr>
            <td>
              <img src='images/actual-vs-predicted-2013-14.jpg' height=300 align='middle' style="border-style: none">
            </td>
            <td>
              <img src='images/rf-actual-vs-predicted-2013-14.jpg' height=300 align='middle' style="border-style: none">
            </td>
          </tr>
        </table>
      </div>
    
      <p>We use a linear regressor to predict and we find a very high accuracy for both the seasons.</p>

        <p>Add extra comments.</p>

       <div class="content">

      </div>
    </section>

    <section>
        <h1><a id="cs109-FIFA" class="anchor" href="#cs109-fifa" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conclusions</h1>

        <p>Fill in relevant details</p>
    </section>

    
      <footer> 
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
  </body> 
</html>
<!doctype html>

